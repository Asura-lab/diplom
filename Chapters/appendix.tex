% \renewcommand{\thesubsection}{\Alph{section}}
\newpage
\titleformat{\chapter}[block]{\huge{}\bfseries\centering}{}{0.5em}{}

\chapter*{ХАВСРАЛТ}
\addcontentsline{toc}{chapter}{Хавсралт}

\section*{Хавсралт А. Моделийн архитектурын код}

\begin{lstlisting}[language=Python, caption=ForexHybridNetV2 моделийн архитектур]
class ForexHybridNetV2(nn.Module):
    def __init__(
        self,
        num_features: int,
        conv_channels: int = 192,
        lstm_hidden: int = 384,
        num_attention_heads: int = 8,
        dropout: float = 0.25
    ):
        super().__init__()
        
        # Multi-scale CNN Feature Extractor
        self.conv_blocks = nn.Sequential(
            ResidualConvBlock(num_features, conv_channels, 7, dropout),
            SEBlock(conv_channels),
            ResidualConvBlock(conv_channels, conv_channels, 5, dropout),
            SEBlock(conv_channels),
            ResidualConvBlock(conv_channels, conv_channels, 3, dropout),
        )
        
        # Bidirectional LSTM
        self.lstm = nn.LSTM(
            input_size=conv_channels,
            hidden_size=lstm_hidden // 2,
            num_layers=3,
            batch_first=True,
            dropout=dropout,
            bidirectional=True
        )
        self.lstm_norm = nn.LayerNorm(lstm_hidden)
        
        # Multi-Head Self Attention
        self.self_attn = MultiHeadAttention(
            lstm_hidden, 
            num_heads=num_attention_heads, 
            dropout=dropout
        )
        
        # Attention Pooling
        self.attn_pool = AttentionPooling(lstm_hidden)
        
        # Task-specific heads
        self.reg_head = nn.Sequential(
            nn.Linear(lstm_hidden, 256),
            nn.LayerNorm(256),
            nn.GELU(),
            nn.Dropout(dropout),
            nn.Linear(256, 128),
            nn.LayerNorm(128),
            nn.GELU(),
            nn.Linear(128, 1)
        )
        
        self.dir_head = nn.Sequential(
            nn.Linear(lstm_hidden, 128),
            nn.LayerNorm(128),
            nn.GELU(),
            nn.Dropout(dropout),
            nn.Linear(128, 64),
            nn.GELU(),
            nn.Linear(64, 1)
        )
        
        self.big_move_head = nn.Sequential(
            nn.Linear(lstm_hidden, 128),
            nn.LayerNorm(128),
            nn.GELU(),
            nn.Dropout(dropout),
            nn.Linear(128, 64),
            nn.GELU(),
            nn.Linear(64, 2)
        )
\end{lstlisting}

\section*{Хавсралт Б. Техникийн индикаторуудын код}

\begin{lstlisting}[language=Python, caption=RSI индикатор]
def rsi(series: pd.Series, period: int = 14) -> pd.Series:
    delta = series.diff()
    gain = delta.clip(lower=0)
    loss = -delta.clip(upper=0)
    avg_gain = gain.ewm(
        alpha=1/period, 
        adjust=False, 
        min_periods=period
    ).mean()
    avg_loss = loss.ewm(
        alpha=1/period, 
        adjust=False, 
        min_periods=period
    ).mean()
    rs = avg_gain / (avg_loss + 1e-9)
    return 100 - (100 / (1 + rs))
\end{lstlisting}

\begin{lstlisting}[language=Python, caption=MACD индикатор]
def macd(close: pd.Series, fast=12, slow=26, signal=9):
    fast_ema = close.ewm(span=fast, adjust=False).mean()
    slow_ema = close.ewm(span=slow, adjust=False).mean()
    macd_line = fast_ema - slow_ema
    signal_line = macd_line.ewm(span=signal, adjust=False).mean()
    histogram = macd_line - signal_line
    return macd_line, signal_line, histogram
\end{lstlisting}

\section*{Хавсралт В. Focal Loss хэрэгжүүлэлт}

\begin{lstlisting}[language=Python, caption=Focal Loss]
class FocalLoss(nn.Module):
    def __init__(self, gamma=2.0, alpha=0.25, pos_weight=None):
        super().__init__()
        self.gamma = gamma
        self.alpha = alpha
        self.pos_weight = pos_weight
    
    def forward(self, inputs, targets):
        bce_loss = F.binary_cross_entropy_with_logits(
            inputs, targets, 
            pos_weight=self.pos_weight, 
            reduction='none'
        )
        probs = torch.sigmoid(inputs)
        pt = torch.where(targets == 1, probs, 1 - probs)
        focal_weight = (1 - pt) ** self.gamma
        focal_loss = self.alpha * focal_weight * bce_loss
        return focal_loss.mean()
\end{lstlisting}

\section*{Хавсралт Г. Hyperparameter тохиргоо}

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|}
\hline
\textbf{Параметр} & \textbf{Утга} & \textbf{Тайлбар} \\
\hline
TARGET\_HORIZON\_MIN & 10 & Таамаглах хугацаа (минут) \\
\hline
SEQ\_LEN & 240 & Оролтын дарааллын урт \\
\hline
BATCH\_SIZE & 256 & Batch хэмжээ \\
\hline
EPOCHS & 100 & Хамгийн их epoch \\
\hline
LEARNING\_RATE & 3e-4 & Суралцах хурд \\
\hline
WEIGHT\_DECAY & 1e-3 & Weight decay \\
\hline
WARMUP\_EPOCHS & 5 & Warmup epoch \\
\hline
EARLY\_STOPPING\_PATIENCE & 12 & Early stopping patience \\
\hline
NOISE\_STD & 0.015 & Noise augmentation std \\
\hline
RARE\_EVENT\_WEIGHT & 30.0 & Ховор үйл явдлын жин \\
\hline
DIR\_LABEL\_SMOOTH & 0.08 & Direction label smoothing \\
\hline
BIGMOVE\_LABEL\_SMOOTH & 0.05 & Big move label smoothing \\
\hline
SWA\_START\_EPOCH & 40 & SWA эхлэх epoch \\
\hline
SWA\_LR & 1e-5 & SWA learning rate \\
\hline
FOCAL\_GAMMA & 2.0 & Focal loss gamma \\
\hline
FOCAL\_ALPHA & 0.25 & Focal loss alpha \\
\hline
CONV\_CHANNELS & 192 & CNN channel тоо \\
\hline
LSTM\_HIDDEN & 384 & LSTM hidden хэмжээс \\
\hline
NUM\_ATTENTION\_HEADS & 8 & Attention head тоо \\
\hline
DROPOUT\_RATE & 0.25 & Dropout хувь \\
\hline
\end{tabular}
\caption{Hyperparameter тохиргоо}
\end{table}

\section*{Хавсралт Д. Төслийн файлын бүтэц}

\begin{lstlisting}[basicstyle=\ttfamily\small]
Forex-Signal-App/
+-- backend/
|   +-- app.py
|   +-- config/
|   |   +-- settings.py
|   +-- ml/
|   |   +-- features/
|   |   +-- models/
|   |   +-- preprocessing/
|   +-- utils/
|       +-- mt5_handler.py
|       +-- unirate_handler.py
+-- mobile_app/
|   +-- App.js
|   +-- src/
|   |   +-- components/
|   |   +-- screens/
|   |   +-- services/
|   +-- android/
+-- data/
|   +-- EUR_USD_1min.csv
|   +-- EUR_USD_test.csv
+-- artifacts/
|   +-- eurusd_hybrid_model_v2.pt
+-- models/
|   +-- rl_forex_ppo_lstm/
+-- docs/
|   +-- ...
+-- forex_signal_30min.ipynb
+-- requirements.txt
\end{lstlisting}
